---
layout: dcss-post
title: "Data Crawl Stone Soup: Testing 4 newbie traps in DCSS"
tags: [dcss, data-visualization]
---

<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[2]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="o">%</span><span class="k">matplotlib</span> inline
<span class="kn">from</span> <span class="nn">__future__</span> <span class="k">import</span> <span class="n">division</span>
<span class="kn">from</span> <span class="nn">matplotlib</span> <span class="k">import</span> <span class="n">pyplot</span> <span class="k">as</span> <span class="n">plt</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">IPython.display</span> <span class="k">import</span> <span class="n">Image</span>

<span class="kn">from</span> <span class="nn">vis_common</span> <span class="k">import</span> <span class="n">load_store</span><span class="p">,</span> <span class="n">load_games</span>
<span class="kn">import</span> <span class="nn">winrate</span>

<span class="n">FS</span> <span class="o">=</span> <span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span> <span class="c"># Reasonable default figsize</span>
<span class="n">QUANTILES</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="o">.</span><span class="mi">25</span><span class="p">,</span> <span class="o">.</span><span class="mi">5</span><span class="p">,</span> <span class="o">.</span><span class="mi">7</span><span class="p">,</span> <span class="o">.</span><span class="mi">85</span><span class="p">,</span> <span class="o">.</span><span class="mi">95</span><span class="p">,</span> <span class="mf">1.</span><span class="p">]</span>
<span class="n">QUANTILE_LABELS</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;0-25%&#39;</span><span class="p">,</span> <span class="s">&#39;25-50%&#39;</span><span class="p">,</span> <span class="s">&#39;50-70%&#39;</span><span class="p">,</span> <span class="s">&#39;70-85%&#39;</span><span class="p">,</span> <span class="s">&#39;85-95%&#39;</span><span class="p">,</span> <span class="s">&#39;95-100%&#39;</span><span class="p">]</span>


<span class="n">store</span> <span class="o">=</span> <span class="n">load_store</span><span class="p">()</span>
<span class="n">g</span> <span class="o">=</span> <span class="n">games</span> <span class="o">=</span> <span class="n">load_games</span><span class="p">()</span>
<span class="n">g</span><span class="p">[</span><span class="s">&#39;wr&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">winrate</span><span class="o">.</span><span class="n">smoothed_winrate</span><span class="p">(</span><span class="n">g</span><span class="p">)</span>
<span class="n">g</span><span class="p">[</span><span class="s">&#39;quantile&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">qcut</span><span class="p">(</span><span class="n">g</span><span class="p">[</span><span class="s">&#39;wr&#39;</span><span class="p">],</span> <span class="n">q</span><span class="o">=</span><span class="n">QUANTILES</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="n">QUANTILE_LABELS</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>A "newbie trap" is an ill-advised gameplay decision that inexperienced players are likely to make because they don't know any better.</p>
<p>For example, before version 0.14, the entrance to the Orcish Mines would appear between levels 6-11 of the dungeon - on average, earlier than the less-deadly Lair of Beasts. Experienced players (and those who read walkthrough guides) knew to look for the lair first, and backtrack to the mines later. Newbs would go straight into the mines and get crushed.</p>
<p>In this post, I'll try to use data to test the validity of some putative newbie traps.</p>
<h2 id="Methodology">Methodology<a class="anchor-link" href="#Methodology">&#182;</a></h2><p>(Details for nerds - feel free to skip)</p>
<p>I assigned each player a smoothed winrate estimate - see <a href="TODO">this post</a> for more details.</p>
<p>I associated with each game the winrate estimate of the player, and then partitioned the games according to quantiles of the smoothed winrate.</p>
<p>For each 'trap', I'll be comparing behaviour between these slices, either all simultaneously, or pitting some of the bottom range against the top (e.g. the bottom 25% vs. the top 10%).</p>
<p>A few technical notes:</p>
<ul>
<li>Yeah, the quantiles aren't evenly distributed. There's more interesting variation at the top.</li>
<li>The quantiles are calculated with respect to the set of games, not players. The "0-25%" quantile bounds the bottom quarter of games (measured by player winrate), not the bottom 25% of players. (It was just a little simpler to do this way. Also, doing player quantiles would have exacerbated the asymmetry, since the top 10% of games by winrate were played by the top ~3% of players).</li>
</ul>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[3]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">ppq</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s">&#39;quantile&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">gr</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">gr</span><span class="p">[</span><span class="s">&#39;pid&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()))</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="s">&#39;# players&#39;</span><span class="p">)</span>
<span class="n">gpq</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s">&#39;quantile&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">size</span><span class="p">()</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="s">&#39;# games&#39;</span><span class="p">)</span>
<span class="nb">print</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">ppq</span><span class="p">,</span> <span class="n">gpq</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area"><div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>          # players  # games
quantile                    
0-25%           533   331625
25-50%         2336   332180
50-70%         5579   264832
70-85%        16242   198965
85-95%          618   132792
95-100%         696    65768
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Mutation-roulette">1. Mutation roulette<a class="anchor-link" href="#Mutation-roulette">&#182;</a></h2><p>Are newbs more likely to optimistically quaff potions of mutation, or eat mutagenic meat, hoping for some beneficial mutations?</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[5]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">m</span> <span class="o">=</span> <span class="n">store</span><span class="p">[</span><span class="s">&#39;mutations&#39;</span><span class="p">]</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">nrows</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">11</span><span class="p">,</span><span class="mi">13</span><span class="p">))</span>
<span class="k">for</span> <span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="n">ax</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">([</span><span class="s">&#39;potion of mutation&#39;</span><span class="p">,</span> <span class="s">&#39;mutagenic meat&#39;</span><span class="p">],</span> <span class="n">axes</span><span class="o">.</span><span class="n">flatten</span><span class="p">()):</span>
    <span class="n">g</span><span class="p">[</span><span class="s">&#39;muts&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">m</span><span class="p">[(</span><span class="n">m</span><span class="p">[</span><span class="s">&#39;source&#39;</span><span class="p">]</span><span class="o">==</span><span class="n">src</span><span class="p">)]</span>\
        <span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s">&#39;gid&#39;</span><span class="p">,</span> <span class="s">&#39;turn&#39;</span><span class="p">],</span> <span class="n">as_index</span><span class="o">=</span><span class="k">False</span><span class="p">)</span><span class="o">.</span><span class="n">agg</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="mi">1</span><span class="p">)</span>\
        <span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s">&#39;gid&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">size</span><span class="p">()</span>
    <span class="n">g</span><span class="p">[</span><span class="s">&#39;muts&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="k">True</span><span class="p">)</span>

    <span class="n">g</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s">&#39;quantile&#39;</span><span class="p">)[[</span><span class="s">&#39;muts&#39;</span><span class="p">,</span> <span class="s">&#39;turns&#39;</span><span class="p">]]</span>\
        <span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="s">&#39;muts&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">/</span> <span class="n">x</span><span class="p">[</span><span class="s">&#39;turns&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">())</span>\
        <span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s">&#39;{} consumption normalized by #turns&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">src</span><span class="p">))</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s">&#39;y&#39;</span><span class="p">);</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area"><div class="prompt"></div>


<div class="output_png output_subarea ">
<img src="/assets/dcss_newbie_traps/newbie_traps_4_0.png"
>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>(Each bar corresponds to a subset of games grouped by player "talent" (= smoothed win rate estimate). 0-25% is the bottom quarter, 95-100% is the top 5%)</p>
<p>Seems like a pretty clear trend! The top 5% of games in particular involve half as much mutagen consumption per turn as the bottom half.</p>
<p>On average, the games on the far right are lasting a lot longer than the ones on the left. If all players liked to quaff a bunch of mutations early on and never again after, then normalizing by number of turns would have the effect of making longer games seem less mutation-happy.</p>
<p>Just to be safe, let's control for this. I'll fix some turn count N, and ask: of the games that last at least N turns, how many potions of mutation are quaffed before turn N?</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[6]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="c"># Alternative metric: of games lasting at least N turns, avg. number of </span>
<span class="c"># mut pots quaffed before turn N?</span>
<span class="n">turn_thresh</span> <span class="o">=</span> <span class="mi">4351</span> <span class="c"># Median quaff turn</span>

<span class="n">mutquaffs</span> <span class="o">=</span> <span class="n">m</span><span class="p">[(</span><span class="n">m</span><span class="p">[</span><span class="s">&#39;source&#39;</span><span class="p">]</span><span class="o">==</span><span class="s">&#39;potion of mutation&#39;</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">m</span><span class="p">[</span><span class="s">&#39;turn&#39;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">turn_thresh</span><span class="p">)]</span>\
    <span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s">&#39;gid&#39;</span><span class="p">,</span> <span class="s">&#39;turn&#39;</span><span class="p">],</span> <span class="n">as_index</span><span class="o">=</span><span class="k">False</span><span class="p">)</span><span class="o">.</span><span class="n">agg</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="mi">1</span><span class="p">)</span>\
    <span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s">&#39;gid&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">size</span><span class="p">()</span>
<span class="n">g</span><span class="p">[</span><span class="s">&#39;muts&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mutquaffs</span>
<span class="n">g</span><span class="p">[</span><span class="s">&#39;muts&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="k">True</span><span class="p">)</span>

<span class="n">g</span><span class="p">[</span><span class="n">g</span><span class="p">[</span><span class="s">&#39;turns&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">turn_thresh</span><span class="p">]</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s">&#39;quantile&#39;</span><span class="p">)[</span><span class="s">&#39;muts&#39;</span><span class="p">]</span>\
    <span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="p">)</span>\
    <span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">FS</span><span class="p">,</span> 
              <span class="n">title</span><span class="o">=</span><span class="s">&quot;Avg. pots of mut quaffed before turn {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">turn_thresh</span><span class="p">)</span>
             <span class="p">);</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area"><div class="prompt"></div>


<div class="output_png output_subarea ">
<img src="/assets/dcss_newbie_traps/newbie_traps_6_0.png"
>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><strong>Verdict:</strong></p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[7]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">Image</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="s">&#39;/assets/dcss/trap.png&#39;</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area"><div class="prompt output_prompt">Out[7]:</div>

<div class="output_html rendered_html output_subarea output_execute_result">
<img src="/assets/dcss/trap.png"/>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Spellcasting-overinvestment">2. Spellcasting overinvestment<a class="anchor-link" href="#Spellcasting-overinvestment">&#182;</a></h2><p>A thread in the Tavern asks <a href="https://crawl.develz.org/tavern/viewtopic.php?f=17&amp;t=19396">Why do new players invest so many XP into spellcasting?</a>, pointing to a CiP post as an example. Some suggest it's because newbs don't understand what the skill does, or that automatic XP assignment tends to favour it. Others are skeptical about whether this is truly a newbish trait.</p>
<p>Let's look at Spellcasting investment specifically among deep elf wizards (to control for aptitudes and starting skills).</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[8]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">sk</span> <span class="o">=</span> <span class="n">store</span><span class="p">[</span><span class="s">&#39;skill_progression&#39;</span><span class="p">]</span>

<span class="k">def</span> <span class="nf">skill_progression</span><span class="p">(</span><span class="n">group</span><span class="p">,</span> <span class="n">skill</span><span class="o">=</span><span class="s">&#39;spellcasting&#39;</span><span class="p">,</span> <span class="n">max_level</span><span class="o">=</span><span class="mi">28</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">sk</span><span class="p">[(</span><span class="n">sk</span><span class="p">[</span><span class="s">&#39;skill&#39;</span><span class="p">]</span><span class="o">==</span><span class="n">skill</span><span class="p">)</span> <span class="o">&amp;</span> <span class="n">sk</span><span class="p">[</span><span class="s">&#39;gid&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">group</span><span class="o">.</span><span class="n">index</span><span class="p">)]</span>\
        <span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s">&#39;lvl&#39;</span><span class="p">)[</span><span class="s">&#39;xl&#39;</span><span class="p">]</span>\
        <span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">reindex</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">Index</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">max_level</span><span class="p">)))</span>
    
<span class="n">quant_groups</span> <span class="o">=</span> <span class="p">[[</span><span class="s">&#39;0-25%&#39;</span><span class="p">,</span> <span class="s">&#39;25-50%&#39;</span><span class="p">],</span> <span class="p">[</span><span class="s">&#39;85-95%&#39;</span><span class="p">,</span> <span class="s">&#39;95-100%&#39;</span><span class="p">]]</span>
<span class="n">quant_labels</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;bottom 50%&#39;</span><span class="p">,</span> <span class="s">&#39;top 15%&#39;</span><span class="p">]</span>
<span class="k">def</span> <span class="nf">quant_group</span><span class="p">(</span><span class="n">label</span><span class="p">):</span>
    <span class="n">q</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">label</span><span class="p">,</span> <span class="s">&#39;quantile&#39;</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">q</span> <span class="ow">in</span> <span class="n">quant_groups</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
        <span class="k">return</span> <span class="mi">0</span>
    <span class="k">elif</span> <span class="n">q</span> <span class="ow">in</span> <span class="n">quant_groups</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
        <span class="k">return</span> <span class="mi">1</span>
    
<span class="k">def</span> <span class="nf">plot_progress</span><span class="p">(</span><span class="n">sps</span><span class="p">,</span> <span class="n">bgs</span><span class="p">,</span> <span class="n">skill</span><span class="o">=</span><span class="s">&#39;spellcasting&#39;</span><span class="p">,</span> <span class="n">max_skill</span><span class="o">=</span><span class="mi">28</span><span class="p">,</span> 
                  <span class="n">transpose</span><span class="o">=</span><span class="k">False</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="k">None</span><span class="p">,</span> <span class="n">min_games</span><span class="o">=</span><span class="mi">5</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">qg</span> <span class="ow">in</span> <span class="n">quant_groups</span><span class="p">:</span>
        <span class="n">relevant_games</span> <span class="o">=</span> <span class="n">g</span><span class="p">[(</span><span class="n">g</span><span class="p">[</span><span class="s">&#39;species&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">sps</span><span class="p">))</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">g</span><span class="p">[</span><span class="s">&#39;bg&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">bgs</span><span class="p">))</span> 
                           <span class="o">&amp;</span> <span class="n">g</span><span class="p">[</span><span class="s">&#39;quantile&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">qg</span><span class="p">)]</span>
        <span class="n">games_per_lvl</span> <span class="o">=</span> <span class="n">sk</span><span class="p">[(</span><span class="n">sk</span><span class="p">[</span><span class="s">&#39;skill&#39;</span><span class="p">]</span><span class="o">==</span><span class="n">skill</span><span class="p">)</span> <span class="o">&amp;</span> <span class="n">sk</span><span class="p">[</span><span class="s">&#39;gid&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">relevant_games</span><span class="o">.</span><span class="n">index</span><span class="p">)]</span>\
            <span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s">&#39;lvl&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">size</span><span class="p">()</span>
        <span class="n">toosmall</span> <span class="o">=</span> <span class="p">(</span><span class="n">games_per_lvl</span> <span class="o">&lt;</span> <span class="n">min_games</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">toosmall</span><span class="o">.</span><span class="n">any</span><span class="p">():</span>
            <span class="c"># idquitek what&#39;s going on here</span>
            <span class="k">if</span> <span class="n">toosmall</span><span class="o">.</span><span class="n">all</span><span class="p">():</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&quot;Not enough games&quot;</span><span class="p">)</span>
            <span class="n">first_bigenough</span> <span class="o">=</span> <span class="n">toosmall</span><span class="o">.</span><span class="n">argmin</span><span class="p">()</span>
            <span class="n">am</span> <span class="o">=</span> <span class="n">toosmall</span><span class="p">[</span><span class="n">first_bigenough</span><span class="p">:]</span><span class="o">.</span><span class="n">argmax</span><span class="p">()</span>
            <span class="n">max_skill</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">max_skill</span><span class="p">,</span> <span class="n">am</span><span class="p">)</span>
    
    <span class="c">#max_skill = 10</span>
    <span class="n">relevant_games</span> <span class="o">=</span> <span class="n">g</span><span class="p">[(</span><span class="n">g</span><span class="p">[</span><span class="s">&#39;species&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">sps</span><span class="p">))</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">g</span><span class="p">[</span><span class="s">&#39;bg&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">bgs</span><span class="p">))</span> <span class="p">]</span>
    <span class="n">ppq</span> <span class="o">=</span> <span class="n">progression_per_quantile</span> <span class="o">=</span> <span class="n">relevant_games</span>\
        <span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">quant_group</span><span class="p">)</span>\
        <span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">skill_progression</span><span class="p">,</span> <span class="n">skill</span><span class="o">=</span><span class="n">skill</span><span class="p">,</span> <span class="n">max_level</span><span class="o">=</span><span class="n">max_skill</span><span class="p">)</span>\
        <span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="c"># Drop null columns (= skill levels for which we have no data)</span>

    <span class="k">if</span> <span class="n">ax</span> <span class="ow">is</span> <span class="k">None</span><span class="p">:</span>
        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">FS</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">quant</span><span class="p">,</span> <span class="n">label</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">ppq</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">quant_labels</span><span class="p">):</span>
        <span class="n">prog</span> <span class="o">=</span> <span class="n">ppq</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">quant</span><span class="p">]</span>
        <span class="c"># skill level, XL (the natural ordering)</span>
        <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">prog</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">prog</span><span class="o">.</span><span class="n">values</span>
        <span class="k">if</span> <span class="n">transpose</span><span class="p">:</span>
            <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">y</span><span class="p">,</span> <span class="n">x</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span>
            <span class="n">marker</span><span class="o">=</span><span class="s">&#39;.&#39;</span><span class="p">,</span>
            <span class="n">linestyle</span><span class="o">=</span><span class="s">&#39;-&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">)</span>

    <span class="n">skill_label</span> <span class="o">=</span> <span class="s">&#39;{} level&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">skill</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">skill_label</span> <span class="k">if</span> <span class="n">transpose</span> <span class="k">else</span> <span class="s">&#39;avg. XL&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s">&#39;avg. XL&#39;</span> <span class="k">if</span> <span class="n">transpose</span> <span class="k">else</span> <span class="n">skill_label</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">transpose</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">(</span><span class="n">ppq</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c">#ax.set_xticks(ppq.loc[0].index)</span>
        <span class="n">y0</span><span class="p">,</span> <span class="n">y1</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_ylim</span><span class="p">()</span>
        <span class="c">#ax.set_yticks(np.arange(int(y0), int(y1)+1, 1))</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s">&#39;both&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">();</span>
    <span class="k">return</span> <span class="n">ax</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[12]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">sps</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;deep elf&#39;</span><span class="p">]</span>
<span class="n">bgs</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;wizard&#39;</span><span class="p">]</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">plot_progress</span><span class="p">(</span><span class="n">sps</span><span class="p">,</span> <span class="n">bgs</span><span class="p">,</span> <span class="n">max_skill</span><span class="o">=</span><span class="mi">13</span><span class="p">);</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s">&quot;Spellcasting skill ups: Deep Elf Wizards&quot;</span><span class="p">);</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area"><div class="prompt"></div>


<div class="output_png output_subarea ">
<img src="/assets/dcss_newbie_traps/newbie_traps_11_0.png"
>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Characters in the bottom-half consistently reach a given level of spellcasting a full player level before characters in the top 15%.</p>
<p>(Note that skill level is on the x-axis and player level on the y-axis. The transpose seems more natural, but this arrangement better reflects the underlying data. Morguefiles give the player level (XL) when each skill levels up, not the other way around. Technically each point should be read as "of DEWz characters that reached Spellcasting level x, the average XL at which they did so was y")</p>
<p>Let's throw together a bunch of popular caster species and backgrounds, to make sure this isn't a fluke specific to DEWz's. This'll also give us a big enough sample to extend the comparison to late-game.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[13]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">sps</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;deep elf&#39;</span><span class="p">,</span> <span class="s">&#39;human&#39;</span><span class="p">,</span> <span class="s">&#39;tengu&#39;</span><span class="p">,</span> <span class="s">&#39;octopode&#39;</span><span class="p">,</span> <span class="s">&#39;high elf&#39;</span><span class="p">}</span>
<span class="n">bgs</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;wizard&#39;</span><span class="p">,</span> <span class="s">&#39;conjurer&#39;</span><span class="p">,</span> <span class="s">&#39;fire elementalist&#39;</span><span class="p">,</span> <span class="s">&#39;air elementalist&#39;</span><span class="p">,</span> 
      <span class="s">&#39;earth elementalist&#39;</span><span class="p">,</span> <span class="s">&#39;ice elementalist&#39;</span><span class="p">,</span> <span class="s">&#39;summoner&#39;</span><span class="p">}</span>
<span class="nb">print</span> <span class="s">&quot;Considering all species/bg combos in {} x {}...&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">sps</span><span class="p">,</span> <span class="n">bgs</span><span class="p">)</span>
<span class="n">plot_progress</span><span class="p">(</span><span class="n">sps</span><span class="p">,</span> <span class="n">bgs</span><span class="p">);</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area"><div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>Considering all species/bg combos in set([&#39;octopode&#39;, &#39;tengu&#39;, &#39;high elf&#39;, &#39;deep elf&#39;, &#39;human&#39;]) x set([&#39;summoner&#39;, &#39;wizard&#39;, &#39;earth elementalist&#39;, &#39;conjurer&#39;, &#39;ice elementalist&#39;, &#39;fire elementalist&#39;, &#39;air elementalist&#39;])...
</pre>
</div>
</div>

<div class="output_area"><div class="prompt"></div>


<div class="output_png output_subarea ">
<img src="/assets/dcss_newbie_traps/newbie_traps_13_1.png"
>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Wow! The gap just gets wider. Around the mid-to-late game, the bottom half are hitting spellcasting milestones 3-4 levels earlier than their high-winrate counterparts. That's huge!</p>
<p><strong>Verdict</strong></p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[14]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">Image</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="s">&#39;/assets/dcss/trap.png&#39;</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area"><div class="prompt output_prompt">Out[14]:</div>

<div class="output_html rendered_html output_subarea output_execute_result">
<img src="/assets/dcss/trap.png"/>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Octopodes">3. Picking Octopodes<a class="anchor-link" href="#Octopodes">&#182;</a></h2><p>In an <a href="/blog/dcss_species">earlier post</a> analyzing species, I speculated that Octopodes' last-place win-rate might be because they're attractive to newbs. (Granted, they're a weird species with a very impactful limitation - no armour. But they're easy to grok, and the promise of getting to wear 8 rings is a cool hook.)</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[15]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="k">def</span> <span class="nf">plot_species_pickrate</span><span class="p">(</span><span class="n">species</span><span class="p">):</span>
    <span class="n">pickrate</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">g</span><span class="p">[</span><span class="n">g</span><span class="p">[</span><span class="s">&#39;species&#39;</span><span class="p">]</span><span class="o">==</span><span class="n">species</span><span class="p">]</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s">&#39;quantile&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">size</span><span class="p">()</span> 
        <span class="o">/</span> 
        <span class="n">g</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s">&#39;quantile&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">size</span><span class="p">()</span>
    <span class="p">)</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">pickrate</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">FS</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s">&#39;y&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s">&#39;Pick rate&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_yticklabels</span><span class="p">(</span><span class="s">&#39;{:.1f}%&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="mi">100</span><span class="o">*</span><span class="n">y</span><span class="p">)</span> <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_yticks</span><span class="p">())</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s">&quot;{} pick rate by quantile&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">species</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">ax</span>

<span class="n">plot_species_pickrate</span><span class="p">(</span><span class="s">&#39;octopode&#39;</span><span class="p">);</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area"><div class="prompt"></div>


<div class="output_png output_subarea ">
<img src="/assets/dcss_newbie_traps/newbie_traps_17_0.png"
>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>This is vaguely consistent with my hypothesis, but the difference from one end of the player base to the other is not huge, and the second most prestigious group has the second-highest pick rate.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[16]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">Image</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="s">&#39;/assets/dcss/notatrap.png&#39;</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area"><div class="prompt output_prompt">Out[16]:</div>

<div class="output_html rendered_html output_subarea output_execute_result">
<img src="/assets/dcss/notatrap.png"/>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>I also speculated that Deep Dwarves may have the highest win rate of all species because they're the opposite of a newbie trap. They're a mechanically tricky species with a very intimidating constraint (no HP regeneration). Maybe only veterans are confident enough to play them.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[17]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">plot_species_pickrate</span><span class="p">(</span><span class="s">&#39;deep dwarf&#39;</span><span class="p">);</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area"><div class="prompt"></div>


<div class="output_png output_subarea ">
<img src="/assets/dcss_newbie_traps/newbie_traps_21_0.png"
>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Well that's much more compelling.</p>
<p>One interesting thing to note is that the players in the bottom quarter here are actually not likely to be newbs in the literal sense.</p>
<p>There are virtually no wins in the bottom half. What separates the two bottom quarters is the size of their track record of failure. Players in the bottom quarter have all played 250+ games without a win. Players in the next quarter have a mere streak of 50-250 losses (or, rarely, a single win out of &gt;1,000 games).</p>
<p>So it might be more correct to say that this suggests that successful players are attracted to deep dwarves and unsuccessful players (not necessarily <em>inexperienced</em> players) are uninterested in DDs.</p>
<h2 id="Early-rune-grabs">4. Early rune grabs<a class="anchor-link" href="#Early-rune-grabs">&#182;</a></h2><p>A couple months ago I introduced my boyfriend to DCSS, and it's been a lot of fun watching him progress. He's committed to not reading spoilers until he's won a game, so he's a great subject of observation when it comes to newbie traps.</p>
<p>He recently got his <a href="http://crawl.berotato.org/crawl/morgue/falsifian/falsifian.txt">first rune</a> ever. How he managed it at level 15, I have no idea. I was playing a Deep Elf in parallel with his, and I picked up my first rune at level 18, after having cleared the Dungeon, the Orcish Mines, and the first 3 floors of the other S-branch. He cleared up to D:9, cleared the Lair, then waltzed straight down to the bottom of the Swamp.</p>
<p>I would guess that this is not an uncommon mistake. When you get to a staircase, the natural thing is to go down it. Incrementally clearing and backtracking isn't an obvious strategy. And the spike in danger of the final floor of a branch is something you either read about, or learn from painful experience.</p>
<p>(<a href="https://crawl.develz.org/tavern/viewtopic.php?f=17&amp;t=19840">This tavern post</a> has a cool idea about restructuring the dungeon to make this less of a trap.)</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[18]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">r</span> <span class="o">=</span> <span class="n">store</span><span class="p">[</span><span class="s">&#39;runes&#39;</span><span class="p">]</span>
<span class="n">r</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">g</span><span class="p">[</span><span class="s">&#39;quantile&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">to_frame</span><span class="p">(),</span> <span class="n">left_on</span><span class="o">=</span><span class="s">&#39;gid&#39;</span><span class="p">,</span> <span class="n">right_index</span><span class="o">=</span><span class="k">True</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[19]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">quant_groups</span> <span class="o">=</span> <span class="p">[[</span><span class="s">&#39;0-25%&#39;</span><span class="p">,</span> <span class="s">&#39;25-50%&#39;</span><span class="p">],</span> <span class="p">[</span><span class="s">&#39;85-95%&#39;</span><span class="p">,</span> <span class="s">&#39;95-100%&#39;</span><span class="p">]]</span>
<span class="n">quant_labels</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;bottom 50%&#39;</span><span class="p">,</span> <span class="s">&#39;top 15%&#39;</span><span class="p">]</span>
<span class="k">def</span> <span class="nf">quant_group</span><span class="p">(</span><span class="n">label</span><span class="p">):</span>
    <span class="n">q</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">label</span><span class="p">,</span> <span class="s">&#39;quantile&#39;</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">q</span> <span class="ow">in</span> <span class="n">quant_groups</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
        <span class="k">return</span> <span class="mi">0</span>
    <span class="k">elif</span> <span class="n">q</span> <span class="ow">in</span> <span class="n">quant_groups</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
        <span class="k">return</span> <span class="mi">1</span>

<span class="k">def</span> <span class="nf">plot_rune_levels</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="k">None</span><span class="p">):</span>
    <span class="n">rune_levels</span> <span class="o">=</span> <span class="n">r</span><span class="p">[</span><span class="n">r</span><span class="p">[</span><span class="s">&#39;order&#39;</span><span class="p">]</span><span class="o">==</span><span class="n">order</span><span class="p">]</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s">&#39;xl&#39;</span><span class="p">,</span> <span class="n">quant_group</span><span class="p">])</span><span class="o">.</span><span class="n">size</span><span class="p">()</span>\
        <span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>\
        <span class="o">.</span><span class="n">pivot</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="s">&#39;level_1&#39;</span><span class="p">,</span> <span class="n">values</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>\
        <span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="c"># Normalize</span>
    <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]:</span>
        <span class="n">rune_levels</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="n">rune_levels</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">/</span> <span class="n">rune_levels</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
    <span class="n">rune_levels</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="mi">0</span><span class="p">:</span> <span class="n">quant_labels</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">1</span><span class="p">:</span> <span class="n">quant_labels</span><span class="p">[</span><span class="mi">1</span><span class="p">]},</span> <span class="n">inplace</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">rune_levels</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&#39;quantile&#39;</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">rune_levels</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">FS</span><span class="p">,</span> <span class="n">stacked</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">quant_labels</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s">&quot;Level when snatching rune # {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">order</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">ax</span>

<span class="n">plot_rune_levels</span><span class="p">(</span><span class="n">r</span><span class="p">);</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area"><div class="prompt"></div>


<div class="output_png output_subarea ">
<img src="/assets/dcss_newbie_traps/newbie_traps_24_0.png"
>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Level 15! Damn falsifian, you were really on the scary side of the bell curve.</p>
<p>XL isn't a great universal scale for how advanced a character is, because of differences in XP aptitudes between species. Let's generate the same graph from just deep elf games as a sanity check.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[20]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">deepgids</span> <span class="o">=</span> <span class="n">g</span><span class="p">[</span><span class="n">g</span><span class="p">[</span><span class="s">&#39;species&#39;</span><span class="p">]</span><span class="o">==</span><span class="s">&#39;deep elf&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">index</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">plot_rune_levels</span><span class="p">(</span>
    <span class="n">r</span><span class="p">[</span><span class="n">r</span><span class="p">[</span><span class="s">&#39;gid&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">deepgids</span><span class="p">)]</span>
<span class="p">);</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area"><div class="prompt"></div>


<div class="output_png output_subarea ">
<img src="/assets/dcss_newbie_traps/newbie_traps_26_0.png"
>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Still quite a clear difference!</p>
<p>Let's add runes 2 and 3 to the mix.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[21]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">nrows</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="mi">17</span><span class="p">),</span> <span class="n">sharex</span><span class="o">=</span><span class="k">True</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">ax</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">4</span><span class="p">),</span> <span class="n">axes</span><span class="o">.</span><span class="n">flatten</span><span class="p">()):</span>
    <span class="n">plot_rune_levels</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="n">i</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area"><div class="prompt"></div>


<div class="output_png output_subarea ">
<img src="/assets/dcss_newbie_traps/newbie_traps_28_0.png"
>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Hold your horses, noobs!</p>
<p><strong>Verdict</strong></p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[22]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">Image</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="s">&#39;/assets/dcss/trap.png&#39;</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area"><div class="prompt output_prompt">Out[22]:</div>

<div class="output_html rendered_html output_subarea output_execute_result">
<img src="/assets/dcss/trap.png"/>
</div>

</div>

</div>
</div>

</div>
 

